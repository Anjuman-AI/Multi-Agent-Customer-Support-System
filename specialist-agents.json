{
  "name": "04 - AI Specialist Agents Playground",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "test-agent",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        240,
        400
      ],
      "webhookId": "test-agent-playground"
    },
    {
      "parameters": {
        "jsCode": "// Extract and validate input\nconst body = $input.first().json.body || {};\n\nconst message = body.message || '';\nconst category = (body.category || 'GENERAL').toUpperCase();\nconst priority = (body.priority || 'MEDIUM').toUpperCase();\nconst sentiment = (body.sentiment || 'NEUTRAL').toUpperCase();\nconst customer_name = body.customer_name || 'Test Customer';\nconst customer_email = body.customer_email || 'test@example.com';\nconst subject = body.subject || 'Test Subject';\nconst test_all = body.test_all || false;\n\n// Validate inputs\nconst validCategories = ['BUG', 'BILLING', 'FEATURE', 'GENERAL'];\nconst validPriorities = ['LOW', 'MEDIUM', 'HIGH', 'URGENT'];\nconst validSentiments = ['POSITIVE', 'NEUTRAL', 'NEGATIVE'];\n\nif (!message) {\n  throw new Error('Message is required');\n}\n\nif (!validCategories.includes(category)) {\n  throw new Error(`Category must be one of: ${validCategories.join(', ')}`);\n}\n\nif (!validPriorities.includes(priority)) {\n  throw new Error(`Priority must be one of: ${validPriorities.join(', ')}`);\n}\n\nif (!validSentiments.includes(sentiment)) {\n  throw new Error(`Sentiment must be one of: ${validSentiments.join(', ')}`);\n}\n\nreturn [{\n  json: {\n    message,\n    category,\n    priority,\n    sentiment,\n    customer_name,\n    customer_email,\n    subject,\n    test_all,\n    ticket_id: `TEST-${Date.now()}`,\n    created_at: new Date().toISOString(),\n    test_mode: true\n  }\n}];"
      },
      "id": "validate-input",
      "name": "Validate Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        460,
        400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.test_all}}",
              "value2": true
            }
          ]
        }
      },
      "id": "test-mode-check",
      "name": "Test All Agents?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        680,
        400
      ]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "options": {
          "temperature": 0.3,
          "maxTokens": 300
        },
        "prompt": "=You are an expert customer support triage agent.\n\nYour role: Analyze customer messages and categorize them accurately.\n\nüìã CATEGORIES:\n- BUG: Technical issues, errors, crashes, bugs, problems with functionality\n- BILLING: Payment issues, subscriptions, refunds, invoices, charges\n- FEATURE: Feature requests, suggestions, improvements, enhancements\n- GENERAL: Questions, how-to, information requests, general inquiries\n\nüìä PRIORITY LEVELS:\n- URGENT: System down, payment blocked, data loss, security issue\n- HIGH: Significant impact, affecting work, multiple users\n- MEDIUM: Single user issue, workaround available\n- LOW: Questions, minor issues, suggestions\n\nüé≠ SENTIMENT:\n- POSITIVE: Happy, satisfied, thankful customer\n- NEUTRAL: Normal inquiry, no strong emotion\n- NEGATIVE: Frustrated, angry, disappointed customer\n\nüîç ANALYSIS GUIDELINES:\n‚úì Read the entire message carefully\n‚úì Identify key keywords and phrases\n‚úì Consider tone and urgency\n‚úì Look for multiple issues (prioritize most urgent)\n‚úì Detect emotional state\n‚úì Assess complexity and risk\n\nüìù CUSTOMER MESSAGE:\n{{$json.message}}\n\nüë§ Customer: {{$json.customer_name}} ({{$json.customer_email}})\nüìß Subject: {{$json.subject}}\nüì± Channel: {{$json.source || 'test'}}\n\n‚ö†Ô∏è IMPORTANT: Respond ONLY with valid JSON (no markdown, no explanation):\n\n{\n  \"category\": \"BUG|BILLING|FEATURE|GENERAL\",\n  \"priority\": \"LOW|MEDIUM|HIGH|URGENT\",\n  \"confidence\": 0.95,\n  \"sentiment\": \"POSITIVE|NEUTRAL|NEGATIVE\",\n  \"reasoning\": \"Brief explanation of categorization (1-2 sentences)\",\n  \"needs_human\": false,\n  \"keywords\": [\"key\", \"words\", \"detected\"],\n  \"suggested_subject\": \"Brief subject line for ticket\",\n  \"complexity_score\": 3,\n  \"estimated_resolution_time\": \"5 minutes\"\n}"
      },
      "id": "triage-agent",
      "name": "üîç Triage Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        900,
        400
      ],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI GPT-4"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse triage response\nconst triageText = $input.first().json.text || $input.first().json.choices?.[0]?.message?.content || '';\n\nlet triageData;\ntry {\n  const cleanText = triageText.replace(/```json\\n?|```\\n?/g, '').trim();\n  triageData = JSON.parse(cleanText);\n} catch (error) {\n  triageData = {\n    category: 'GENERAL',\n    priority: 'MEDIUM',\n    confidence: 0.5,\n    sentiment: 'NEUTRAL',\n    reasoning: 'Failed to parse AI response',\n    needs_human: true,\n    keywords: [],\n    suggested_subject: 'Support Request',\n    complexity_score: 5,\n    estimated_resolution_time: 'unknown'\n  };\n}\n\nconst allData = $input.first().json;\nreturn [{\n  json: {\n    ...allData,\n    triage: triageData,\n    category: triageData.category,\n    priority: triageData.priority,\n    confidence: triageData.confidence,\n    sentiment: triageData.sentiment\n  }\n}];"
      },
      "id": "parse-triage",
      "name": "Parse Triage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        400
      ]
    },
    {
      "parameters": {
        "mode": "chooseBranch",
        "output": "={{$json.category}}"
      },
      "id": "route-by-category",
      "name": "Route by Category",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        1340,
        400
      ]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "options": {
          "temperature": 0.7,
          "maxTokens": 500
        },
        "prompt": "=You are a technical support specialist AI agent.\n\nüéØ YOUR ROLE:\nHelp customers resolve technical issues with empathy, clarity, and professionalism.\n\n‚úÖ BEST PRACTICES:\n‚Ä¢ Start with empathy - acknowledge their frustration\n‚Ä¢ Use simple, non-technical language\n‚Ä¢ Provide step-by-step instructions (numbered)\n‚Ä¢ Offer multiple solutions when possible\n‚Ä¢ Set realistic expectations\n‚Ä¢ Ask clarifying questions if needed\n‚Ä¢ Explain WHY (helps understanding)\n‚Ä¢ Provide workarounds for immediate relief\n\n‚ùå NEVER:\n‚Ä¢ Blame the customer (\"You did X wrong...\")\n‚Ä¢ Use jargon without explanation\n‚Ä¢ Make promises you can't keep\n‚Ä¢ Ignore their emotional state\n‚Ä¢ Give up easily\n‚Ä¢ Be condescending\n\nüìä CUSTOMER CONTEXT:\n‚Ä¢ Priority: {{$json.priority}}\n‚Ä¢ Sentiment: {{$json.sentiment}}\n‚Ä¢ Name: {{$json.customer_name}}\n‚Ä¢ Confidence: {{$json.confidence}}\n\nüí¨ CUSTOMER MESSAGE:\n{{$json.message}}\n\nüé® RESPONSE STRUCTURE:\n1. Empathetic opening (acknowledge issue)\n2. Immediate action they can take\n3. Step-by-step troubleshooting (3-5 steps)\n4. Alternative solutions or workarounds\n5. What happens next / timeline\n6. Encouraging close\n\nüìù EXAMPLE OPENING:\n\"I understand how frustrating it is when [issue]. Let me help you get this resolved right away.\"\n\n‚ö° QUICK TIPS:\n‚Ä¢ If {{$json.priority}} is HIGH/URGENT: Prioritize speed\n‚Ä¢ If {{$json.sentiment}} is NEGATIVE: Extra empathy\n‚Ä¢ If {{$json.confidence}} < 0.8: Ask more questions\n\nüí° Generate your response (200-300 words):\n"
      },
      "id": "bug-handler",
      "name": "üêõ Bug Handler Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        1560,
        200
      ],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI GPT-4"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4",
        "options": {
          "temperature": 0.6,
          "maxTokens": 450
        },
        "prompt": "=You are a billing support specialist AI agent.\n\nüéØ YOUR ROLE:\nHandle payment, subscription, and billing inquiries with empathy and professionalism.\n\n‚úÖ BEST PRACTICES:\n‚Ä¢ Be extra empathetic (money is sensitive)\n‚Ä¢ Explain charges clearly and transparently\n‚Ä¢ Protect customer financial data (never ask for full card numbers)\n‚Ä¢ Offer solutions proactively\n‚Ä¢ Escalate refunds to humans\n‚Ä¢ Acknowledge billing errors immediately\n‚Ä¢ Be patient with confusion\n‚Ä¢ Build trust through transparency\n\n‚ùå NEVER:\n‚Ä¢ Dismiss their concerns\n‚Ä¢ Make them feel stupid for not understanding\n‚Ä¢ Ask for sensitive info (full card, SSN, passwords)\n‚Ä¢ Argue about charges\n‚Ä¢ Make refund promises (humans handle this)\n‚Ä¢ Use complex financial jargon\n\nüîí SECURITY RULES:\n‚úì Can: Confirm last 4 digits, billing dates, amounts\n‚úó Cannot: Request full card numbers, CVV, passwords\n‚úó Cannot: Process refunds (escalate to human)\n\nüìä CUSTOMER CONTEXT:\n‚Ä¢ Priority: {{$json.priority}}\n‚Ä¢ Sentiment: {{$json.sentiment}}\n‚Ä¢ Name: {{$json.customer_name}}\n‚Ä¢ Email: {{$json.customer_email}}\n\nüí¨ CUSTOMER MESSAGE:\n{{$json.message}}\n\nüé® RESPONSE STRUCTURE:\n1. Empathetic acknowledgment of billing concern\n2. Explanation of charges (clear, simple)\n3. Solution or next steps\n4. Reassurance about security/data\n5. Escalation note if refund/dispute needed\n6. Professional close\n\nüö® AUTO-ESCALATE IF:\n‚Ä¢ Customer requests refund\n‚Ä¢ Disputes a charge\n‚Ä¢ Reports unauthorized charge\n‚Ä¢ Mentions \"lawyer\" or \"legal\"\n‚Ä¢ Billing error confirmed\n\nüìù EXAMPLE:\n\"I completely understand your concern about this charge. Let me explain what happened and how we can resolve this...\"\n\nüí° Generate your response (200-300 words):\n"
      },
      "id": "billing-agent",
      "name": "üí∞ Billing Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        1560,
        320
      ],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI GPT-4"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4",
        "options": {
          "temperature": 0.8,
          "maxTokens": 400
        },
        "prompt": "=You are a product specialist AI agent.\n\nüéØ YOUR ROLE:\nHandle feature requests with enthusiasm while managing expectations realistically.\n\n‚úÖ BEST PRACTICES:\n‚Ä¢ Show genuine excitement for their ideas\n‚Ä¢ Thank them sincerely for feedback\n‚Ä¢ Check if feature already exists (search knowledge)\n‚Ä¢ Explain product vision and roadmap\n‚Ä¢ Offer workarounds or alternatives\n‚Ä¢ Manage expectations honestly\n‚Ä¢ Keep them engaged and positive\n‚Ä¢ Make them feel heard\n\n‚ùå NEVER:\n‚Ä¢ Promise features will be built\n‚Ä¢ Give specific timelines (unless confirmed)\n‚Ä¢ Dismiss their ideas\n‚Ä¢ Say \"that's not possible\"\n‚Ä¢ Make them feel their request isn't important\n‚Ä¢ Be defensive about current limitations\n\nüìä CUSTOMER CONTEXT:\n‚Ä¢ Name: {{$json.customer_name}}\n‚Ä¢ Priority: {{$json.priority}}\n‚Ä¢ Sentiment: {{$json.sentiment}}\n\nüí¨ CUSTOMER MESSAGE:\n{{$json.message}}\n\nüé® RESPONSE STRUCTURE:\n1. Enthusiastic thank you\n2. Validate their idea (why it's valuable)\n3. Check if feature exists (or similar)\n4. Current product status\n5. Alternative solutions/workarounds\n6. What happens next (logged for product team)\n7. Encouraging close\n\nüí° RESPONSE TONE:\n‚Ä¢ Enthusiastic but honest\n‚Ä¢ Appreciative of feedback\n‚Ä¢ Solution-oriented\n‚Ä¢ Transparent about limitations\n‚Ä¢ Forward-looking\n\nüìù EXAMPLE:\n\"Thank you so much for this suggestion! I love how you're thinking about [benefit]. This is exactly the kind of feedback our product team values...\"\n\nüéØ GOAL:\nLeave customer feeling heard and valued, even if we can't implement immediately.\n\n‚ú® Generate your response (200-300 words):\n"
      },
      "id": "feature-agent",
      "name": "‚ú® Feature Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        1560,
        440
      ],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI GPT-4"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4",
        "options": {
          "temperature": 0.7,
          "maxTokens": 400
        },
        "prompt": "=You are a general customer support AI agent.\n\nüéØ YOUR ROLE:\nAnswer questions and provide information with clarity and friendliness.\n\n‚úÖ BEST PRACTICES:\n‚Ä¢ Be warm and approachable\n‚Ä¢ Provide clear, accurate information\n‚Ä¢ Link to documentation when relevant\n‚Ä¢ Anticipate follow-up questions\n‚Ä¢ Be concise but thorough\n‚Ä¢ Use examples when helpful\n‚Ä¢ Encourage further questions\n‚Ä¢ Build confidence\n\n‚ùå NEVER:\n‚Ä¢ Be robotic or cold\n‚Ä¢ Assume knowledge level\n‚Ä¢ Give incomplete answers\n‚Ä¢ Ignore nuance in their question\n‚Ä¢ Rush through explanation\n‚Ä¢ Sound annoyed\n\nüìä CUSTOMER CONTEXT:\n‚Ä¢ Name: {{$json.customer_name}}\n‚Ä¢ Priority: {{$json.priority}}\n‚Ä¢ Sentiment: {{$json.sentiment}}\n\nüí¨ CUSTOMER MESSAGE:\n{{$json.message}}\n\nüé® RESPONSE STRUCTURE:\n1. Friendly greeting\n2. Direct answer to their question\n3. Additional relevant information\n4. Examples or use cases (if helpful)\n5. Links to documentation/resources\n6. Invitation for follow-up questions\n7. Friendly close\n\nüí° RESPONSE TONE:\n‚Ä¢ Friendly and professional\n‚Ä¢ Clear and educational\n‚Ä¢ Patient and supportive\n‚Ä¢ Encouraging\n\nüìù EXAMPLE:\n\"Great question! Let me walk you through this. [Answer] Here's a quick example to make it clearer...\"\n\nüéØ GOAL:\nLeave customer feeling informed, confident, and welcome to ask more.\n\nüìö DOCUMENTATION:\nIf relevant, mention:\n‚Ä¢ Help docs: docs.example.com\n‚Ä¢ Video tutorials: youtube.com/example\n‚Ä¢ Community forum: community.example.com\n\n‚ú® Generate your response (200-300 words):\n"
      },
      "id": "general-agent",
      "name": "üí¨ General Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        1560,
        560
      ],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI GPT-4"
        }
      }
    },
    {
      "parameters": {
        "keepOnlySet": false,
        "values": {
          "string": [
            {
              "name": "ai_response",
              "value": "={{$json.text || $json.choices?.[0]?.message?.content || 'Unable to generate response'}}"
            },
            {
              "name": "agent_used",
              "value": "={{$json.category === 'BUG' ? 'Bug Handler' : $json.category === 'BILLING' ? 'Billing Agent' : $json.category === 'FEATURE' ? 'Feature Agent' : 'General Agent'}}"
            }
          ]
        },
        "options": {}
      },
      "id": "extract-response",
      "name": "Extract Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        1780,
        400
      ]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "options": {
          "temperature": 0.2,
          "maxTokens": 250
        },
        "prompt": "=You are an escalation decision agent.\n\nüéØ YOUR ROLE:\nDetermine if human intervention is required (conservative approach).\n\nüö® ESCALATE WHEN:\n‚Ä¢ Customer is angry/frustrated/threatening\n‚Ä¢ Keywords: lawyer, legal, lawsuit, BBB, social media threat\n‚Ä¢ Refund or cancellation request\n‚Ä¢ Billing dispute or unauthorized charge\n‚Ä¢ Data loss or security concern\n‚Ä¢ Complex technical issue requiring deep expertise\n‚Ä¢ Multiple failed resolution attempts\n‚Ä¢ VIP/enterprise customer\n‚Ä¢ AI confidence < 0.7\n‚Ä¢ Customer explicitly requests human\n‚Ä¢ Negative sentiment + HIGH/URGENT priority\n‚Ä¢ Issue affects multiple users\n‚Ä¢ Regulatory/compliance concern\n\n‚úÖ DO NOT ESCALATE:\n‚Ä¢ Simple FAQ with clear answer\n‚Ä¢ Documentation exists and was provided\n‚Ä¢ AI confidence > 0.9\n‚Ä¢ Low risk of dissatisfaction\n‚Ä¢ Common question\n‚Ä¢ Positive/neutral sentiment + low/medium priority\n\nüìä REVIEW THIS INTERACTION:\n\nüí¨ Customer Message:\n{{$json.message}}\n\nüîç Triage Results:\n‚Ä¢ Category: {{$json.category}}\n‚Ä¢ Priority: {{$json.priority}}\n‚Ä¢ Sentiment: {{$json.sentiment}}\n‚Ä¢ Confidence: {{$json.confidence}}\n\nüí° AI Response Generated:\n{{$json.ai_response}}\n\n‚öñÔ∏è DECISION FACTORS:\n1. Customer emotional state\n2. Issue complexity\n3. Risk level\n4. AI confidence\n5. Resolution likelihood\n\n‚ö†Ô∏è IMPORTANT: Respond ONLY with valid JSON (no markdown):\n\n{\n  \"should_escalate\": true/false,\n  \"reason\": \"Clear explanation why escalating or not\",\n  \"urgency\": \"LOW|MEDIUM|HIGH\",\n  \"confidence\": 0.95,\n  \"suggested_action\": \"Specific action for human agent if escalated\",\n  \"estimated_resolution_time\": \"2 hours\",\n  \"risk_score\": 3,\n  \"escalation_tags\": [\"billing_dispute\", \"refund_request\"]\n}"
      },
      "id": "escalation-agent",
      "name": "üö® Escalation Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        2000,
        400
      ],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI GPT-4"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse escalation decision\nconst escalationText = $input.first().json.text || $input.first().json.choices?.[0]?.message?.content || '';\n\nlet escalationData;\ntry {\n  const cleanText = escalationText.replace(/```json\\n?|```\\n?/g, '').trim();\n  escalationData = JSON.parse(cleanText);\n} catch (error) {\n  // Conservative: escalate if parsing fails\n  escalationData = {\n    should_escalate: true,\n    reason: 'Failed to parse escalation decision - escalating to be safe',\n    urgency: 'MEDIUM',\n    confidence: 0.5,\n    suggested_action: 'Review manually and respond',\n    estimated_resolution_time: '24 hours',\n    risk_score: 5,\n    escalation_tags: ['parsing_error']\n  };\n}\n\nconst allData = $input.first().json;\nreturn [{\n  json: {\n    ...allData,\n    escalation: escalationData,\n    needs_human: escalationData.should_escalate,\n    escalation_reason: escalationData.reason,\n    escalation_urgency: escalationData.urgency\n  }\n}];"
      },
      "id": "parse-escalation",
      "name": "Parse Escalation",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2220,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Build comprehensive test response\nconst data = $input.first().json;\n\n// Format timestamp\nconst timestamp = new Date(data.created_at).toLocaleString();\n\n// Calculate processing time\nconst processingTime = Date.now() - new Date(data.created_at).getTime();\n\nconst response = {\n  success: true,\n  test_mode: true,\n  ticket_id: data.ticket_id,\n  timestamp: timestamp,\n  processing_time_ms: processingTime,\n  \n  input: {\n    message: data.message,\n    customer_name: data.customer_name,\n    customer_email: data.customer_email,\n    subject: data.subject\n  },\n  \n  triage: {\n    category: data.category,\n    priority: data.priority,\n    sentiment: data.sentiment,\n    confidence: data.confidence,\n    reasoning: data.triage?.reasoning,\n    keywords: data.triage?.keywords,\n    suggested_subject: data.triage?.suggested_subject,\n    complexity_score: data.triage?.complexity_score,\n    estimated_resolution_time: data.triage?.estimated_resolution_time\n  },\n  \n  agent: {\n    agent_used: data.agent_used,\n    response: data.ai_response,\n    temperature: data.category === 'BUG' ? 0.7 : \n                 data.category === 'BILLING' ? 0.6 : \n                 data.category === 'FEATURE' ? 0.8 : 0.7,\n    max_tokens: 500\n  },\n  \n  escalation: {\n    should_escalate: data.needs_human,\n    reason: data.escalation_reason,\n    urgency: data.escalation_urgency,\n    confidence: data.escalation?.confidence,\n    suggested_action: data.escalation?.suggested_action,\n    estimated_resolution_time: data.escalation?.estimated_resolution_time,\n    risk_score: data.escalation?.risk_score,\n    tags: data.escalation?.escalation_tags\n  },\n  \n  metrics: {\n    triage_confidence: data.confidence,\n    escalation_confidence: data.escalation?.confidence,\n    overall_risk_score: data.escalation?.risk_score,\n    processing_time_seconds: (processingTime / 1000).toFixed(2)\n  },\n  \n  recommendations: {\n    send_to_customer: !data.needs_human,\n    notify_team: data.needs_human,\n    follow_up_required: data.escalation?.risk_score > 5,\n    priority_handling: data.priority === 'URGENT' || data.priority === 'HIGH'\n  }\n};\n\nreturn [{ json: response }];"
      },
      "id": "format-response",
      "name": "Format Test Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2440,
        400
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{JSON.stringify($json, null, 2)}}",
        "options": {}
      },
      "id": "webhook-response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2660,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Test all agents with the same message\nconst data = $input.first().json;\n\n// Create test cases for all 4 categories\nconst testCases = [\n  { ...data, category: 'BUG', test_name: 'Bug Handler Test' },\n  { ...data, category: 'BILLING', test_name: 'Billing Agent Test' },\n  { ...data, category: 'FEATURE', test_name: 'Feature Agent Test' },\n  { ...data, category: 'GENERAL', test_name: 'General Agent Test' }\n];\n\nreturn testCases.map(tc => ({ json: tc }));"
      },
      "id": "split-for-all-tests",
      "name": "Split for All Agents",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        900,
        540
      ]
    },
    {
      "parameters": {
        "jsCode": "// Collect all test results\nconst allResults = $input.all().map(item => item.json);\n\nconst response = {\n  success: true,\n  test_mode: true,\n  test_type: 'all_agents',\n  message: 'Tested message across all 4 specialist agents',\n  timestamp: new Date().toISOString(),\n  \n  input: {\n    message: allResults[0].message,\n    customer_name: allResults[0].customer_name\n  },\n  \n  results: allResults.map(result => ({\n    agent: result.agent_used,\n    category: result.category,\n    confidence: result.confidence,\n    response: result.ai_response,\n    should_escalate: result.needs_human,\n    escalation_reason: result.escalation_reason\n  })),\n  \n  comparison: {\n    most_confident: allResults.reduce((max, r) => \n      r.confidence > max.confidence ? r : max\n    ).agent_used,\n    \n    escalation_count: allResults.filter(r => r.needs_human).length,\n    \n    avg_response_length: Math.round(\n      allResults.reduce((sum, r) => \n        sum + (r.ai_response?.length || 0), 0\n      ) / allResults.length\n    )\n  },\n  \n  recommendations: {\n    best_agent: allResults.reduce((max, r) => \n      r.confidence > max.confidence ? r : max\n    ).agent_used,\n    \n    message: 'Based on confidence scores, this message is best handled by the ' + \n             allResults.reduce((max, r) => \n               r.confidence > max.confidence ? r : max\n             ).agent_used\n  }\n};\n\nreturn [{ json: response }];"
      },
      "id": "combine-all-results",
      "name": "Combine All Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2440,
        540
      ]
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input": {
      "main": [
        [
          {
            "node": "Test All Agents?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Test All Agents?": {
      "main": [
        [
          {
            "node": "Split for All Agents",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üîç Triage Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîç Triage Agent": {
      "main": [
        [
          {
            "node": "Parse Triage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Triage": {
      "main": [
        [
          {
            "node": "Route by Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Category": {
      "main": [
        [
          {
            "node": "üêõ Bug Handler Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üí∞ Billing Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚ú® Feature Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üí¨ General Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üêõ Bug Handler Agent": {
      "main": [
        [
          {
            "node": "Extract Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üí∞ Billing Agent": {
      "main": [
        [
          {
            "node": "Extract Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ú® Feature Agent": {
      "main": [
        [
          {
            "node": "Extract Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üí¨ General Agent": {
      "main": [
        [
          {
            "node": "Extract Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Response": {
      "main": [
        [
          {
            "node": "üö® Escalation Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üö® Escalation Agent": {
      "main": [
        [
          {
            "node": "Parse Escalation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Escalation": {
      "main": [
        [
          {
            "node": "Format Test Response",
            "type": "main",
            "index": 0
          },
          {
            "node": "Combine All Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Test Response": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split for All Agents": {
      "main": [
        [
          {
            "node": "Route by Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine All Results": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2024-01-09T12:00:00.000Z",
  "versionId": "1"
}
